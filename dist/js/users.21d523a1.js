(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["users"],{2666:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),a("el-breadcrumb-item",[e._v("用户管理")]),a("el-breadcrumb-item",[e._v("用户列表")])],1),a("el-card",{staticClass:"box-card"},[a("el-row",{attrs:{gutter:30}},[a("el-col",{attrs:{span:8}},[a("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入内容",clearable:""},on:{clear:e.getUserList},model:{value:e.queryInfo.query,callback:function(t){e.$set(e.queryInfo,"query",t)},expression:"queryInfo.query"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.getUserList},slot:"append"})],1)],1),a("el-col",{attrs:{span:4}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addDialogVisible=!0}}},[e._v("添加用户")])],1)],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.userlist,border:"",stripe:""}},[a("el-table-column",{attrs:{type:"index",label:"ID",align:"center"}}),a("el-table-column",{attrs:{prop:"username",label:"姓名",align:"center"}}),a("el-table-column",{attrs:{prop:"email",label:"邮箱",align:"center"}}),a("el-table-column",{attrs:{prop:"mobile",label:"电话",align:"center"}}),a("el-table-column",{attrs:{prop:"role_name",label:"角色",align:"center"}}),a("el-table-column",{attrs:{label:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{on:{change:function(a){return e.userActiveChange(t.row)}},model:{value:t.row.mg_state,callback:function(a){e.$set(t.row,"mg_state",a)},expression:"slotProp.row.mg_state"}})]}}])}),a("el-table-column",{attrs:{label:"操作",width:"200px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(a){return e.editDialog(t.row.id)}}}),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(a){return e.removeUser(t.row.id)}}}),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"分配角色",placement:"top",enterable:!1}},[a("el-button",{attrs:{type:"warning",icon:"el-icon-setting",size:"mini"},on:{click:function(a){return e.setRole(t.row)}}})],1)]}}])})],1),a("el-pagination",{attrs:{"current-page":this.queryInfo.pagenum,"page-sizes":[5,10,20],"page-size":e.queryInfo.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),a("el-dialog",{attrs:{title:"添加用户",visible:e.addDialogVisible,width:"50%"},on:{"update:visible":function(t){e.addDialogVisible=t},close:e.addDialogClosed}},[a("el-form",{ref:"addFormRef",staticClass:"demo-ruleForm",attrs:{model:e.addForm,rules:e.addFormRules,"label-width":"70px"}},[a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-input",{model:{value:e.addForm.username,callback:function(t){e.$set(e.addForm,"username",t)},expression:"addForm.username"}})],1),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{type:"password"},model:{value:e.addForm.password,callback:function(t){e.$set(e.addForm,"password",t)},expression:"addForm.password"}})],1),a("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[a("el-input",{model:{value:e.addForm.email,callback:function(t){e.$set(e.addForm,"email",t)},expression:"addForm.email"}})],1),a("el-form-item",{attrs:{label:"手机",prop:"mobile"}},[a("el-input",{model:{value:e.addForm.mobile,callback:function(t){e.$set(e.addForm,"mobile",t)},expression:"addForm.mobile"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.addDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.addUser}},[e._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"修改用户信息",visible:e.editDialogVisible,width:"50%"},on:{"update:visible":function(t){e.editDialogVisible=t}}},[a("el-form",{ref:"editFormRef",staticClass:"demo-ruleForm",attrs:{model:e.editForm,rules:e.addFormRules,"label-width":"70px"}},[a("el-form-item",{attrs:{label:"用户名"}},[a("el-input",{attrs:{disabled:""},model:{value:e.editForm.username,callback:function(t){e.$set(e.editForm,"username",t)},expression:"editForm.username"}})],1),a("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[a("el-input",{model:{value:e.editForm.email,callback:function(t){e.$set(e.editForm,"email",t)},expression:"editForm.email"}})],1),a("el-form-item",{attrs:{label:"手机",prop:"mobile"}},[a("el-input",{model:{value:e.editForm.mobile,callback:function(t){e.$set(e.editForm,"mobile",t)},expression:"editForm.mobile"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.editDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.editUserInfo}},[e._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"分配角色",visible:e.setDialogVisible,width:"50%"},on:{"update:visible":function(t){e.setDialogVisible=t},close:e.setDialogClose}},[a("div",[a("p",[e._v("当前的用户："+e._s(e.userInfo.username))]),a("p",[e._v("当前的角色："+e._s(e.userInfo.role_name))]),a("p",[e._v("分配新角色： "),a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.selectRoleId,callback:function(t){e.selectRoleId=t},expression:"selectRoleId"}},e._l(e.rolesList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.roleName,value:e.id}})})),1)],1)]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.setDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.saveRoleInfo}},[e._v("确 定")])],1)])],1)],1)},r=[],i=(a("99af"),a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),{name:"Users",data:function(){var e=function(e,t,a){var s=/^1[0-9]{10}$/;return s.test(t)?a():a(new Error("请输入合法的手机号"))};return{queryInfo:{query:"",pagenum:1,pagesize:5},userlist:[],total:0,addDialogVisible:!1,editDialogVisible:!1,addForm:{username:"",password:"",email:"",mobile:""},editForm:{},addFormRules:{username:[{required:!0,message:"请输入用户名",trigger:["blur","change"]},{min:3,max:10,message:"用户名长度为3到10位",trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]},{min:6,max:15,message:"密码长度为6到15位",trigger:["blur","change"]}],email:[{required:!0,message:"请输入邮箱号",trigger:["blur","change"]},{type:"email",message:"请输入正确的邮箱号",trigger:["blur","change"]}],mobile:[{required:!0,message:"请输入手机号",trigger:["blur","change"]},{validator:e,trigger:["blur","change"]}]},setDialogVisible:!1,userInfo:{},rolesList:"",selectRoleId:""}},created:function(){this.getUserList()},methods:{getUserList:function(){var e=this;this.$http.get("users",{params:this.queryInfo}).then((function(t){var a=t.data;200===a.meta.status?(e.userlist=a.data.users,e.total=a.data.total):e.$message.error("获取列表失败！")})).catch((function(t){e.$message.warning("服务器错误！")}))},handleSizeChange:function(e){this.queryInfo.pagesize=e,this.getUserList()},handleCurrentChange:function(e){this.queryInfo.pagenum=e,this.getUserList()},userActiveChange:function(e){var t=this;this.$http.put("users/".concat(e.id,"/state/").concat(e.mg_state)).then((function(e){var a=e.data;200===a.meta.status?t.$message.success(a.meta.msg):t.$message.error("修改失败！")})).catch((function(e){t.$message.warning("服务器错误！")}))},addDialogClosed:function(){this.$refs.addFormRef.resetFields()},addUser:function(){var e=this;this.$refs.addFormRef.validate((function(t){if(t){var a=new URLSearchParams;a.append("username",e.addForm.username),a.append("password",e.addForm.password),a.append("email",e.addForm.email),a.append("mobile",e.addForm.mobile),e.$http.post("users",a).then((function(t){var a=t.data;201===a.meta.status?(e.$message.success(a.meta.msg),e.addDialogVisible=!1,e.getUserList()):e.$message.error("添加用户失败！")})).catch((function(t){e.$message.warning("服务器错误！")}))}}))},editDialog:function(e){var t=this;this.editDialogVisible=!0,this.$http.get("users/"+e).then((function(e){var a=e.data;200===a.meta.status?(t.$message.success(a.meta.msg),t.editForm=a.data):t.$message.error("查询信息失败！")})).catch((function(e){t.$message.warning("服务器错误！")}))},editUserInfo:function(){var e=this;this.$refs.editFormRef.validate((function(t){t&&e.$http.put("users/"+e.editForm.id,{email:e.editForm.email,mobile:e.editForm.mobile}).then((function(t){var a=t.data;200===a.meta.status?(e.$message.success(a.meta.msg),e.editDialogVisible=!1,e.getUserList()):e.$message.error("修改失败！")})).catch((function(t){e.$message.warning("服务器错误！")}))}))},removeUser:function(e){var t=this;this.$confirm("此操作将永久删除该用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$http.delete("users/"+e).then((function(e){var a=e.data;200===a.meta.status?(t.$message({type:"success",message:"删除用户成功!"}),t.getUserList()):t.$message.error("删除用户失败！")})).catch((function(e){t.$message.warning("服务器错误！")}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},setRole:function(e){var t=this;this.$http.get("roles").then((function(e){var a=e.data;200===a.meta.status?(t.$message.success(a.meta.msg),t.rolesList=a.data):t.$message.error("获取角色列表失败！")})).catch((function(e){t.$message.warning("服务器错误！")})),this.userInfo=e,this.setDialogVisible=!0},saveRoleInfo:function(){var e=this;if(!this.selectRoleId)return this.$message.error("请选择要分配的角色！");this.$http.put("users/".concat(this.userInfo.id,"/role"),{rid:this.selectRoleId}).then((function(t){var a=t.data;200===a.meta.status?(e.$message.success(a.meta.msg),e.getUserList(),e.setDialogVisible=!1):e.$message.error("修改失败！")})).catch((function(t){e.$message.warning("服务器错误！")}))},setDialogClose:function(){this.selectRoleId="",this.userInfo={}}}}),o=i,l=a("2877"),n=Object(l["a"])(o,s,r,!1,null,"20f992c6",null);t["default"]=n.exports}}]);
//# sourceMappingURL=users.21d523a1.js.map